<?php

use App\Models\{Campaign, Document};
use App\States\Document\PendingDocumentState;

test('it can create document with explicit attributes', function () {
    $campaign = Campaign::factory()->create();
    
    $document = Document::create([
        'campaign_id' => $campaign->id,
        'original_filename' => 'test.pdf',
        'mime_type' => 'application/pdf',
        'size_bytes' => 1024,
        'storage_path' => 'test.pdf',
        'hash' => 'abc123',
    ]);

    expect($document)->toBeInstanceOf(Document::class)
        ->and($document->id)->not->toBeNull()
        ->and($document->uuid)->not->toBeNull();
});

test('it initializes with pending state', function () {
    $campaign = Campaign::factory()->create();
    
    $document = Document::create([
        'campaign_id' => $campaign->id,
        'original_filename' => 'test.pdf',
        'mime_type' => 'application/pdf',
        'size_bytes' => 1024,
        'storage_path' => 'test.pdf',
        'hash' => 'abc123',
    ]);

    expect($document->state)->toBeInstanceOf(PendingDocumentState::class);
});

test('it can make document without saving', function () {
    $campaign = Campaign::factory()->create();
    
    $document = Document::make([
        'campaign_id' => $campaign->id,
        'original_filename' => 'test.pdf',
        'mime_type' => 'application/pdf',
        'size_bytes' => 1024,
        'storage_path' => 'test.pdf',
        'hash' => 'abc123',
    ]);

    expect($document)->toBeInstanceOf(Document::class)
        ->and($document->exists)->toBeFalse();
});
